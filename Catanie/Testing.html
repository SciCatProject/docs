
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Testing Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-api/theme-api.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../Devops/Catamel/Active_Directory_LDAP.html" />
    
    
    <link rel="prev" href="StartHere.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Overview</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    SciCat Metadata Catalogue
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Developers Guide</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="./">
            
                <a href="./">
            
                    
                    SciCat Data Catalogue Developer Guide
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="Archiving.html">
            
                <a href="Archiving.html">
            
                    
                    Archiving/Retrieving/Resetting Datasets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="Configuring.html">
            
                <a href="Configuring.html">
            
                    
                    Running locally
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="Contributing.html">
            
                <a href="Contributing.html">
            
                    
                    Contributing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="Data_Model.html">
            
                <a href="Data_Model.html">
            
                    
                    An Introduction to the Data Model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.5" data-path="Design.html">
            
                <a href="Design.html">
            
                    
                    Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.6" data-path="Development_Methods.html">
            
                <a href="Development_Methods.html">
            
                    
                    Git Flow Workflow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.7" data-path="Environment.html">
            
                <a href="Environment.html">
            
                    
                    Environment file
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.8" data-path="GettingMetadataIntoScicat.html">
            
                <a href="GettingMetadataIntoScicat.html">
            
                    
                    Getting Metadata Into SciCat.
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.9" data-path="Login.html">
            
                <a href="Login.html">
            
                    
                    Login
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.10" data-path="Ngrx.html">
            
                <a href="Ngrx.html">
            
                    
                    Services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.11" data-path="StartHere.html">
            
                <a href="StartHere.html">
            
                    
                    So, you have just started working on SciCat?
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.1.12" data-path="Testing.html">
            
                <a href="Testing.html">
            
                    
                    Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.13" data-path="../Devops/Catamel/Active_Directory_LDAP.html">
            
                <a href="../Devops/Catamel/Active_Directory_LDAP.html">
            
                    
                    Active Directory LDAP
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">User Guide</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../Users/">
            
                <a href="../Users/">
            
                    
                    Screenshots and guides
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="../Users/Dashboard/">
            
                <a href="../Users/Dashboard/">
            
                    
                    Dashboard
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="../Users/Dataset_Attachments/">
            
                <a href="../Users/Dataset_Attachments/">
            
                    
                    Dataset Attachments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="../Users/Edit_Scientific_Metadata.html">
            
                <a href="../Users/Edit_Scientific_Metadata.html">
            
                    
                    Edit Scientific Metadata
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="../Users/Jobs/">
            
                <a href="../Users/Jobs/">
            
                    
                    Archival and Retrieval Jobs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.5" data-path="../Users/Login/">
            
                <a href="../Users/Login/">
            
                    
                    Login
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.6" data-path="../Users/SampleData/">
            
                <a href="../Users/SampleData/">
            
                    
                    Sample Data Entry
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Testing</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="testing"><a href="https://angular.io/docs/ts/latest/guide/testing.html" target="_blank">Testing</a></h1>
<p>All components of SciCat include unit test coverage and catanie has additional end to end user interface testing. Tests are run by CI before any change request is approved.</p>
<h1 id="e2e-protractor">E2E (<a href="http://www.protractortest.org/#/" target="_blank">Protractor</a>)</h1>
<p>Initially Protractor was used for end to end testing but this was abandoned in favour of the far more robust and flexible <a href="https://www.cypress.io/" target="_blank">Cypress</a>.</p>
<h1 id="cypress-e2e">Cypress E2E</h1>
<p>Cypress is not based on Selenium. </p>
<p><code>npx cypress run</code> runs all tests headless (without displaying the browser).</p>
<p><code>npx cypress open</code> opens the Cypress GUI in the browser.</p>
<p><code>npx cypress run --spec /home/encima/dev/melanie/catanie/cypress/integration/policy-delegate.spec.js</code> will run the single test file policy-delegate.spec.js.</p>
<h1 id="unit-jasmine-run-by-karma">Unit (Jasmine, run by Karma)</h1>
<p><code>ng test</code> runs all unit tests.</p>
<h3 id="mocking-services">Mocking Services</h3>
<p>Create a mock service and implement only what you need</p>
<pre><code>class MockUserApi {

  getCurrentId() {
    return 123;
  }
}
</code></pre><p>Now, set your testbed to override the service you are mocking.</p>
<pre><code>TestBed.overrideComponent(AppComponent, {
    set: {
      providers: [
        { provide: UserApi, useClass: MockUserApi }
      ]
    }
</code></pre><p>The practice I have followed is to create a <code>MockStubs</code> file that contains only the necessary mocked methods for services or pipes or components. This file can be added to to allow almost complete coverage of the app.</p>
<h1 id="anatomy-of-a-unit-test">Anatomy of a Unit Test</h1>
<h2 id="beforeeach">BeforeEach</h2>
<p>These are called to set up the test and involve 2 important methods.</p>
<h3 id="configuretestingmodule"><code>configureTestingModule</code></h3>
<p>This should include imports for all the modules used in the component. If the component also includes other components, then they should be included. This is also true for any pipes that may be used in the template. I am not sure if there is a fix for this but that does mean that, if a subcomponent uses a pipe then it should be included in all the specs.</p>
<h3 id="overridecomponent"><code>overrideComponent</code></h3>
<p>Test cases for a component should test as few things outside of the component as possible (services etc should have their own tests), but this causes problems for the services implemnted in each component. This is especially true for the loopback services, but also HTTP and Router. In the <code>overrideComponent</code> method, you can specify the service names and provide an alternative class to use.</p>
<p>For every service your component uses, there should be a <code>Mock</code> equivalent that provides hardcoded data in response to their calls. First, check the service exists in <code>MockStubs.ts</code> in the root of the <code>app</code> folder. If it is not in there, please implement it only in that file.  You do <strong>not</strong> need to implement every method, others can add to these when they are needed.</p>
<p>The format in the <code>spec</code> file should be as follows:</p>
<pre><code>{ provide: RawDatasetApi, useClass: MockDatasetApi }
</code></pre><p>The default test merely tests the creation of a component. This is merely opinion but a component should not be considered complete on a branch until the initial tests pass. A release should not go live untilthe coverage of the tests covers more than just basic functionality, i.e. 80% coverage.</p>
<h2 id="state-managementngrx-testing">State management/NGRX testing</h2>
<p>Tests of ngrx state management should test e.g. if a new state object is returned.</p>
<p>Sample ngrx reducer test:</p>
<pre><code class="lang-javascript">  describe(<span class="hljs-string">&apos;SelectDatasetAction&apos;</span>, () =&gt; {
    it(<span class="hljs-string">&apos;should return the state&apos;</span>, () =&gt; {
      <span class="hljs-keyword">const</span> data:DatasetInterface = {owner: <span class="hljs-string">&apos;&apos;</span>, contactEmail: <span class="hljs-string">&apos;&apos;</span>, sourceFolder: <span class="hljs-string">&apos;&apos;</span>, creationTime: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(), type: <span class="hljs-string">&apos;&apos;</span>, ownerGroup: <span class="hljs-string">&apos;&apos;</span>};
      <span class="hljs-keyword">const</span> payload = <span class="hljs-keyword">new</span> Dataset({pid: <span class="hljs-string">&apos;pid 1&apos;</span>, ...data});
      <span class="hljs-keyword">const</span> action = <span class="hljs-keyword">new</span> fromActions.SelectDatasetAction(payload);
      <span class="hljs-keyword">const</span> state = fromDatasets.datasetsReducer(initialDatasetState, action);
      expect(state.selectedSets2).toEqual([payload]);
      expect(state.selectedSets2.constructor).toBe(<span class="hljs-built_in">Array</span>);
    });
  });
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            

        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Testing","level":"2.1.12","depth":2,"next":{"title":"Active Directory LDAP","level":"2.1.13","depth":2,"path":"Devops/Catamel/Active_Directory_LDAP.md","ref":"Devops/Catamel/Active_Directory_LDAP.md","articles":[]},"previous":{"title":"So, you have just started working on SciCat?","level":"2.1.11","depth":2,"path":"Catanie/StartHere.md","ref":"Catanie/StartHere.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["auto-summary","theme-api"],"pluginsConfig":{"auto-summary":{"parts":{"README.md":"Part I","Users/**/*.md":"Part II","Devops/**/*.md":"Part III"}},"theme-api":{"languages":[{"lang":"js","name":"JavaScript","default":true},{"lang":"go","name":"Go"}],"split":true,"theme":"light"},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"Catanie/Testing.md","mtime":"2020-07-29T15:52:13.024Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-07-29T15:52:55.725Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-api/theme-api.js"></script>
        
    

    </body>
</html>

