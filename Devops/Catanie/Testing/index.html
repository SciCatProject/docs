
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Testing Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-theme-api/theme-api.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../../../Users/" />
    
    
    <link rel="prev" href="../Design/" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../../">
            
                <a href="../../../">
            
                    
                    Readme
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../">
            
                <a href="../../">
            
                    
                    Devops
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../../Catamel/">
            
                <a href="../../Catamel/">
            
                    
                    Catamel
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../../Catamel/Testing/">
            
                <a href="../../Catamel/Testing/">
            
                    
                    Testing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../../Documentation/">
            
                <a href="../../Documentation/">
            
                    
                    Documentation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../../General/">
            
                <a href="../../General/">
            
                    
                    General
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="../../General/Development_Methodology/">
            
                <a href="../../General/Development_Methodology/">
            
                    
                    Development_Methodology
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../../Sites/">
            
                <a href="../../Sites/">
            
                    
                    Sites
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="../../Sites/MAXIV/">
            
                <a href="../../Sites/MAXIV/">
            
                    
                    Maxiv
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="../../Sites/ESS/">
            
                <a href="../../Sites/ESS/">
            
                    
                    Ess
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.3" data-path="../../Sites/PSI/">
            
                <a href="../../Sites/PSI/">
            
                    
                    Psi
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../../Catanie-Public/">
            
                <a href="../../Catanie-Public/">
            
                    
                    Catanie-Public
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../">
            
                <a href="../">
            
                    
                    Catanie
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.6.1" data-path="../Design/">
            
                <a href="../Design/">
            
                    
                    Design
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.6.2" data-path="./">
            
                <a href="./">
            
                    
                    Testing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../../Users/">
            
                <a href="../../../Users/">
            
                    
                    Users
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../../../Users/Sections/">
            
                <a href="../../../Users/Sections/">
            
                    
                    Sections
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../../../Users/Sections/SampleData/">
            
                <a href="../../../Users/Sections/SampleData/">
            
                    
                    Sampledata
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../../../Users/Sections/Dashboard/">
            
                <a href="../../../Users/Sections/Dashboard/">
            
                    
                    Dashboard
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="../../../Users/Sections/Jobs/">
            
                <a href="../../../Users/Sections/Jobs/">
            
                    
                    Jobs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="../../../Users/Sections/Login/">
            
                <a href="../../../Users/Sections/Login/">
            
                    
                    Login
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../.." >Testing</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="testing"><a href="https://angular.io/docs/ts/latest/guide/testing.html" target="_blank">Testing</a></h1>
<h1 id="browser-choices">Browser Choices</h1>
<p>Testing can be run on any browser installed on your system. To change this, you can update the settings found in <code>protractor.conf.js</code> and <code>karma.conf.js</code></p>
<h2 id="headless-chrome">Headless Chrome</h2>
<p>As of Chrome 59, a <a href="https://developers.google.com/web/updates/2017/04/headless-chrome" target="_blank">headless</a> option has been added, by using the <code>--headless</code> flag (<code>--disable-gpu</code> is also required in the early versions). In order to run tests in this Chrome by default, first check you have 59 or above at <code>chrome://version</code>.</p>
<h3 id="protractorconfjs"><code>protractor.conf.js</code></h3>
<pre><code class="lang-json">    capabilities: {
        <span class="hljs-string">&apos;browserName&apos;</span>: <span class="hljs-string">&apos;chrome&apos;</span>,
        chromeOptions: {
            args: [<span class="hljs-string">&quot;--headless&quot;</span>, <span class="hljs-string">&quot;--disable-gpu&quot;</span>, <span class="hljs-string">&quot;--window-size=800x600&quot;</span>]
        }
    },
</code></pre>
<h3 id="karmaconfjs"><code>karma.conf.js</code></h3>
<pre><code class="lang-json">    customLaunchers: {
      ChromeHeadless: {
        base: <span class="hljs-string">&apos;Chrome&apos;</span>,
        flags: [
          <span class="hljs-string">&apos;--headless&apos;</span>,
          <span class="hljs-string">&apos;--disable-gpu&apos;</span>,
          <span class="hljs-comment">// Without a remote debugging port, Google Chrome exits immediately.</span>
          <span class="hljs-string">&apos;--remote-debugging-port=9222&apos;</span>
        ]
      }
    },
</code></pre>
<h1 id="e2e-protractor">E2E (<a href="http://www.protractortest.org/#/" target="_blank">Protractor</a>)</h1>
<p>NOTE: Protractor does not support versions of Node beyond 7 because the v8 API made breaking changes.</p>
<p>You can run with <code>npm run e2e</code> or <code>protractor</code> but <strong>YOU MUST</strong> specify the environment as well <code>--environment=qa</code></p>
<p>Useful Links</p>
<ul>
<li><a href="http://chariotsolutions.com/blog/post/testing-angular-2-components-unit-tests-testcomponentbuilder/" target="_blank">Testing Components</a></li>
<li><a href="http://chariotsolutions.com/blog/post/testing-http-services-angular-2-jasmine/" target="_blank">Testing Services</a></li>
</ul>
<h2 id="testing-structure">Testing Structure</h2>
<p>An e2e test should be used to test the functionality as if a user is utilising it. They test a whole <code>story</code>, such as logging in or searching for an item. Protractor provides excellent element selection facilities for this functionality. Most of these tests can be written by simply redirecting the browser to relevant URLs, but this makes it hard to test complex interactions.</p>
<h3 id="page-objects">Page Objects</h3>
<p>We can create a <code>PAGE.po.ts</code> file to encapsulate common actions for a page and import it throughout our testing. For example, a login page object would navigate to the login page and provide methods for <code>login</code>, <code>logout</code> etc by entering text in the correct elements. You can see this in the <code>e2e</code> folder within the repo.</p>
<h3 id="e2e-spec">e2e Spec</h3>
<p>This is where the actual tests are written, with an example below:</p>
<pre><code class="lang-javascript">
describe(<span class="hljs-string">&apos;catanie Dashboard&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">let</span> lp: LoginPage;
  <span class="hljs-keyword">let</span> page: DashboardPage;

  beforeAll(() =&gt; {
    lp = <span class="hljs-keyword">new</span> LoginPage();
    lp.navigateTo().then(() =&gt; {
      lp.enterDetails(browser.params.login.user, browser.params.login.pwd);
      lp.login();
      browser.sleep(<span class="hljs-number">2000</span>);
      page = <span class="hljs-keyword">new</span> DashboardPage();
      page.navigateTo();
    });
  });

  it(<span class="hljs-string">&apos;should be on correct page&apos;</span>, () =&gt; {
    expect(browser.getCurrentUrl()).toContain(<span class="hljs-string">&apos;datasets&apos;</span>);
  });

  it(<span class="hljs-string">&apos;should have an active home menu item&apos;</span>, () =&gt; {
    expect(element(by.css(<span class="hljs-string">&apos;.active.item&apos;</span>)).getText()).toContain(<span class="hljs-string">&apos;Home&apos;</span>);
  });

  it(<span class="hljs-string">&apos;should change active menu item&apos;</span>, () =&gt; {
    <span class="hljs-keyword">const</span> eos = element(by.partialLinkText(<span class="hljs-string">&apos;End of Shift&apos;</span>));
    eos.click();
    expect(eos.getAttribute(<span class="hljs-string">&apos;class&apos;</span>)).toContain(<span class="hljs-string">&apos;active&apos;</span>);
  });
});
</code></pre>
<p>We can execute specific actions before each/any test is run, as well as retrieving elements by almost any means necessary. Note that there is a lot of specific support for Angular as well, which you can read about in the Protractor docs.</p>
<h3 id="element-explorer">Element Explorer</h3>
<p>Running protractor with <code>--elementExplorer</code> opens up your pages with Protractor and gives you a CLI to test out element queries and interactions with them.</p>
<h1 id="unit-jasmine-run-by-karma">Unit (Jasmine, run by Karma)</h1>
<h2 id="testing-components">Testing Components</h2>
<p>Often, when testing a component or a piece of UX, then we would want to test all the functionality. In most cases, this is not necessary and results in testing more than just the one component. In the case of Angular, that could be things like the router module or a custom service. These things can be mocked in the <code>Spec</code> file to ensure that we do not end up importing more than we need.</p>
<h3 id="mocking-services">Mocking Services</h3>
<p>Create a mock service and implement only what you need</p>
<pre><code>class MockUserApi {

  getCurrentId() {
    return 123;
  }
}
</code></pre><p>Now, set your testbed to override the service you are mocking.</p>
<pre><code>TestBed.overrideComponent(AppComponent, {
    set: {
      providers: [
        { provide: UserApi, useClass: MockUserApi }
      ]
    }
</code></pre><p>The practice I have followed is to create a <code>MockStubs</code> file that contains only the necessary mocked methods for services or pipes or components. This file can be added to to allow almost complete coverage of the app.</p>
<h3 id="components-with-input">Components with @Input()</h3>
<p>This may seem trivial but online guides do provide conflicting results. Some recommendations are to make test wrapper components and this is absolutely what you should do if you need to test the actual inputs.</p>
<p>However, if you are testing a component you can mock the Input <a href="https://angular.io/docs/ts/latest/guide/testing.html#!#dashboard-standalone" target="_blank">variable</a> or, even more simple, you can set it as a default value (null, false etc) in the definition of your component; your component logic should be validating these anyway.</p>
<h3 id="schemas-and-components-with-nested-components">Schemas and Components with Nested Components</h3>
<p>If you have created a component that nests another component within, that means that all modules must be imported in both the test module, as well as all components that utilises that component. Confused yet? So was I. This is technically good practice for integration tests but less suitable if you want to test each isolated component. A test on a component with an embedded component should, in my opinion, test only itself; the embedded components should have its own tests.</p>
<p>This can be fixed with the <code>NO_ERRORS_SCHEMA</code> import from <code>@angular/core</code>.</p>
<pre><code>import {NO_ERRORS_SCHEMA} from &apos;@angular/core&apos;;
 TestBed.configureTestingModule({
       schemas : [ NO_ERRORS_SCHEMA ],
</code></pre><p>This should be set in <strong>all</strong> components that contain the component in question. The component that contains the module should <strong>not</strong> do this and should import the module(s). All tests should exist there.</p>
<h1 id="anatomy-of-a-test">Anatomy of a Test</h1>
<p>Here we discuss the breakdown of a test for a component or service. It should be noted that the default tests generated for a component (by the Angular CLI) will fail almost as soon as the component is set up. This section will explain why and what should be done. Some of the points discussed here are mainly in line with the Angular best practices described in ng-book and the docs, but not all of this needs to be followed to the letter.</p>
<h2 id="beforeeach">BeforeEach</h2>
<p>These are called to set up the test and involve 2 important methods.</p>
<h3 id="configuretestingmodule"><code>configureTestingModule</code></h3>
<p>This should include imports for all the modules used in the component. If the component also includes other components, then they should be included. This is also true for any pipes that may be used in the template. I am not sure if there is a fix for this but that does mean that, if a subcomponent uses a pipe then it should be included in all the specs.</p>
<h3 id="overridecomponent"><code>overrideComponent</code></h3>
<p>Test cases for a component should test as few things outside of the component as possible (services etc should have their own tests), but this causes problems for the services implemnted in each component. This is especially true for the loopback services, but also HTTP and Router. In the <code>overrideComponent</code> method, you can specify the service names and provide an alternative class to use.</p>
<p>For every service your component uses, there should be a <code>Mock</code> equivalent that provides hardcoded data in response to their calls. First, check the service exists in <code>MockStubs.ts</code> in the root of the <code>app</code> folder. If it is not in there, please implement it only in that file.  You do <strong>not</strong> need to implement every method, others can add to these when they are needed.</p>
<p>The format in the <code>spec</code> file should be as follows:</p>
<pre><code>{ provide: RawDatasetApi, useClass: MockDatasetApi }
</code></pre><p>The default test merely tests the creation of a component. This is merely opinion but a component should not be considered complete on a branch until the initial tests pass. A release should not go live untilthe coverage of the tests covers more than just basic functionality, i.e. 80% coverage.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            

        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Testing","level":"1.2.6.2","depth":3,"next":{"title":"Users","level":"1.3","depth":1,"path":"Users/README.md","ref":"./Users/README.md","articles":[{"title":"Sections","level":"1.3.1","depth":2,"path":"Users/Sections/README.md","ref":"./Users/Sections/README.md","articles":[{"title":"Sampledata","level":"1.3.1.1","depth":3,"path":"Users/Sections/SampleData/README.md","ref":"./Users/Sections/SampleData/README.md","articles":[]},{"title":"Dashboard","level":"1.3.1.2","depth":3,"path":"Users/Sections/Dashboard/README.md","ref":"./Users/Sections/Dashboard/README.md","articles":[]},{"title":"Jobs","level":"1.3.1.3","depth":3,"path":"Users/Sections/Jobs/README.md","ref":"./Users/Sections/Jobs/README.md","articles":[]},{"title":"Login","level":"1.3.1.4","depth":3,"path":"Users/Sections/Login/README.md","ref":"./Users/Sections/Login/README.md","articles":[]}]}]},"previous":{"title":"Design","level":"1.2.6.1","depth":3,"path":"Devops/Catanie/Design/README.md","ref":"./Devops/Catanie/Design/README.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["theme-api"],"pluginsConfig":{"theme-api":{"languages":[{"lang":"js","name":"JavaScript","default":true},{"lang":"go","name":"Go"}],"split":true,"theme":"light"},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"Devops/Catanie/Testing/README.md","mtime":"2018-05-29T11:46:59.527Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-05-29T11:47:57.135Z"},"basePath":"../../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../../gitbook/gitbook.js"></script>
    <script src="../../../gitbook/theme.js"></script>
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-theme-api/theme-api.js"></script>
        
    

    </body>
</html>

