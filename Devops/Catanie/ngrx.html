
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Ngrx Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-theme-api/theme-api.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="./" />
    
    
    <link rel="prev" href="archiving.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Readme
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../SUMMARY.html">
            
                <a href="../../SUMMARY.html">
            
                    
                    Summary
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../Users/">
            
                <a href="../../Users/">
            
                    
                    Users
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../../Users/Sections/">
            
                <a href="../../Users/Sections/">
            
                    
                    Sections
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../">
            
                <a href="../">
            
                    
                    Devops
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../Sites/">
            
                <a href="../Sites/">
            
                    
                    Sites
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1" data-path="../Sites/MAXIV/">
            
                <a href="../Sites/MAXIV/">
            
                    
                    Maxiv
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.2" data-path="../Sites/ESS/">
            
                <a href="../Sites/ESS/">
            
                    
                    Ess
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.3" data-path="../Sites/PSI/">
            
                <a href="../Sites/PSI/">
            
                    
                    Psi
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.3.1" data-path="../General/deployment.html">
            
                <a href="../General/deployment.html">
            
                    
                    Deployment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.3.2" data-path="../General/data_model.html">
            
                <a href="../General/data_model.html">
            
                    
                    Data_Model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.3.3" data-path="../General/INTRO.html">
            
                <a href="../General/INTRO.html">
            
                    
                    Intro
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../General/">
            
                <a href="../General/">
            
                    
                    General
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="../General/Development_Methodology/">
            
                <a href="../General/Development_Methodology/">
            
                    
                    Development_Methodology
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1.1" data-path="config.html">
            
                <a href="config.html">
            
                    
                    Config
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.1.2" data-path="archiving.html">
            
                <a href="archiving.html">
            
                    
                    Archiving
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4.2.1.3" data-path="ngrx.html">
            
                <a href="ngrx.html">
            
                    
                    Ngrx
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="./">
            
                <a href="./">
            
                    
                    Catanie
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.1" data-path="Design/">
            
                <a href="Design/">
            
                    
                    Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.2" data-path="Testing/">
            
                <a href="Testing/">
            
                    
                    Testing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../Documentation/">
            
                <a href="../Documentation/">
            
                    
                    Documentation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../Catamel/">
            
                <a href="../Catamel/">
            
                    
                    Catamel
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.5.1" data-path="../Catamel/Testing/">
            
                <a href="../Catamel/Testing/">
            
                    
                    Testing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../Catanie-Public/">
            
                <a href="../Catanie-Public/">
            
                    
                    Catanie-Public
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Ngrx</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h4 id="services">Services</h4>
<p>Before the store, we had to import the service into every component that needed it and make calls when the user performed an action. Yep, we put them in the store so each component only imports one thing (the store).</p>
<h2 id="ngrx">NGRX</h2>
<p>OK, so, every part of the <code>store</code> is split into <code>slices</code>. I can see hangouts so feel free to jump in with interruptions or questions (or tell me to skip something). </p>
<p>LB stands for loopback. When loopback generates a library for Angular and Python it puts literally everything in there. Models, services, the whole lot. In catanie, this is put into the <code>shared/sdk</code> folder.</p>
<p>Nope, not the state, we have had to make that manually. Not everything loopback provides we need and not everything needs to be in the store. Anything in the SDK folder should not be edited because it will just overwrite it when a new one is generated (there are exceptions when the Typescript is out of date)</p>
<p>If we have a piece of information we want to put into the store, we need to consider the following 4 things.</p>
<p>NGRX provides the store capabilities, yeah. Action, State etc are all provided by NGRX. Yep, it is. The store is an immutable object.</p>
<h3 id="actions">Actions</h3>
<p>What can be performed. For Jobs, it could be CREATE, CANCEL. We also have  RETRIEVE for viewing the jobs on the Jobs page later. These kind of tie in with the HTTP verbs (but not always, because the store does not have to retrieve anything from the server).</p>
<p>One of the more common examples of the store is a counter. Storing a number in localstorage and increasing it with an INCREMENT action. The way we have done it, each action is essentially a class that can have a payload, that payload will be the changes to make to the store.</p>
<h3 id="state">State</h3>
<p>The state, once created, makes up the store and (ideally) should remain fixed. Each <code>slice</code> of state makes up the whole store. I.e. a <code>users</code> slice could also have a <code>movies</code> slice and a <code>cinema locations</code> slice. All of those things together make up the store. Yep, a slice is like a part of the object. The structure may be easier to see like this:</p>
<pre><code class="lang-javascript">    <span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rootReducer</span>(<span class="hljs-params">state: any, action: Action</span>) </span>{
    <span class="hljs-keyword">return</span> combineReducers({
        user: userReducer,
        datasets: datasetsReducer,
        dashboardUI: dashboardUIReducer,
        jobs: jobsReducer
    })(state, action);
</code></pre>
<p>So, we have a root reducer here that makes up all of our <code>slices</code> and creates the final store. To access jobs, for example, we would write <code>root.jobs.propery</code>. Ideally, the store should be normalised as much as possible and not have too many nested objects. </p>
<p>The state folder we have shows all the slices we put into the store. It is worth noting that we define two things here: </p>
<ol>
<li>an interface for the slice</li>
<li>an initial state with initial values (this makes it easy to reset the store if we need to)</li>
</ol>
<h3 id="reducers">Reducers</h3>
<p>Yep, we combine every reducer into a single root and we access it through there.</p>
<p>Because the store itself is immutable, we cannot access the slices directly, this is where we use reducers. A reducer is essentially an operator that is listening for calls and performing an action when it comes in.</p>
<p>In super simple terms, it is a huge switch statement that goes against basic programming conventions (because we <code>return</code> from each case instead of <code>breaking</code>).</p>
<p>In the user example, we have a few actions. The most important thing to note is <strong>never return a modified version of the store</strong>. You must always return a brand spanking new object made from the current state of the store and the new value you want to modify.</p>
<p>If you never want to run long standing operations (i.e. server calls), these are the only things you need and every action can just be written to describe their function (i.e. DELETE_TABLE_ROW).</p>
<p>But, if you want long operations, then this is where effects come in!</p>
<h3 id="effects">Effects</h3>
<p>An effect is similar to a reducer in that it listens for <code>actions</code> but it also returns an action. This means that we generally follow the convention of:</p>
<ol>
<li>REQUEST - Name of action</li>
<li>REQUEST_COMPLETE - Called when the call is complete</li>
<li>REQUEST_FAILED</li>
</ol>
<p>For example, the login effect for a user is maybe the best one.</p>
<p>The login button is clicked and the LOGIN action is fired. We do nothing with this in the reducer because it changes nothing. However, the effect does listn for it. The default state is that a user is not logged in so nothing changes. Once the user is verified and stored in the state, that is where we make a change.</p>
<p>The services that we used to call from the components should now be removed and centralised into the relevant effects. In the User example, we grab the <code>payload</code> using the <code>map</code> statement.</p>
<p>We then call the <code>login</code> method within the service and pass in the user detais.</p>
<p>SUCCESS? Then we fire the LOGIN_COMPLETE action and send a payload of the new user. The payload just contains the user and the reducer make the change for us.</p>
<p>Our reducer subscribes to LOGIN_COMPLETE, builds a new store from the current one and the newly logged in user. Any component that needs to know about this change subscribes to that slice (i.e. the login page) and performs some checks.</p>
<p>FAILURE? Then we fire LOGIN_FAILED and a message to show. Since we actually check the user credentials against 2 sources, we do not fire a failure immediately. We fire an AD_LOGIN action to try logging in with Active Drectory/LDAP. This calls a second effect that tries our next source and then fires a COMPLETE if it was successful. If it fails, the FAILED is fired and the user is informed.</p>
<p>TL;DR - Actions in the front end will <code>dispatch</code> an action to the relevant slice of the store, this will then be picked up by the <code>reducer</code> or the <code>effect</code> (depending on the name of the action). Changes are carried out and a new store is returned. Relevant parts of the app subscribe to that slice to be informed of changes. </p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            

        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Ngrx","level":"1.4.2.1.3","depth":4,"next":{"title":"Catanie","level":"1.4.3","depth":2,"path":"Devops/Catanie/README.md","ref":"./Devops/Catanie/README.md","articles":[{"title":"Design","level":"1.4.3.1","depth":3,"path":"Devops/Catanie/Design/README.md","ref":"./Devops/Catanie/Design/README.md","articles":[]},{"title":"Testing","level":"1.4.3.2","depth":3,"path":"Devops/Catanie/Testing/README.md","ref":"./Devops/Catanie/Testing/README.md","articles":[]}]},"previous":{"title":"Archiving","level":"1.4.2.1.2","depth":4,"path":"Devops/Catanie/archiving.md","ref":"./Devops/Catanie/archiving.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["theme-api"],"pluginsConfig":{"theme-api":{"languages":[{"lang":"js","name":"JavaScript","default":true},{"lang":"go","name":"Go"}],"split":true,"theme":"light"},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"Devops/Catanie/ngrx.md","mtime":"2018-05-08T19:38:12.797Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-05-08T19:39:32.797Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-theme-api/theme-api.js"></script>
        
    

    </body>
</html>

